{
  "props" : {
    "children" : [ {
      "props" : {
        "children" : [ {
          "props" : {
            "icon" : "location-arrow",
            "label" : {
              "@class" : "Script",
              "content" : "\"<p>Yverdon</p>\"",
              "language" : "JavaScript"
            },
            "layoutStyle" : { },
            "localScriptEval" : {
              "script" : {
                "@class" : "Script",
                "content" : "import { setCurrentMapId } from \"./helprs\";\n\nsetCurrentMapId('yverdon');",
                "language" : "typescript"
              }
            },
            "style" : { }
          },
          "type" : "Button"
        }, {
          "props" : {
            "icon" : "location-arrow",
            "label" : {
              "@class" : "Script",
              "content" : "\"<p>Gen√®ve</p>\"",
              "language" : "JavaScript"
            },
            "layoutStyle" : { },
            "localScriptEval" : {
              "script" : {
                "@class" : "Script",
                "content" : "import { setCurrentMapId } from \"./helprs\";\n\nsetCurrentMapId('yverdon');",
                "language" : "typescript"
              }
            },
            "style" : { }
          },
          "type" : "Button"
        } ]
      },
      "type" : "FlexList"
    }, {
      "props" : {
        "children" : [ {
          "props" : {
            "children" : [ {
              "props" : {
                "children" : [ {
                  "props" : {
                    "children" : [ {
                      "props" : {
                        "confirm" : true,
                        "icon" : "user-ninja",
                        "label" : {
                          "@class" : "Script",
                          "content" : "\"<p>Leave map<br></p>\"",
                          "language" : "JavaScript"
                        },
                        "layoutStyle" : { },
                        "localScriptEval" : {
                          "script" : {
                            "@class" : "Script",
                            "content" : "import { setCurrentMapId } from \"./helprs\";\n\nsetCurrentMapId('')",
                            "language" : "typescript"
                          }
                        },
                        "name" : "leave map",
                        "style" : { }
                      },
                      "type" : "Button"
                    }, {
                      "props" : {
                        "children" : [ {
                          "props" : {
                            "children" : [ {
                              "props" : {
                                "children" : [ {
                                  "props" : {
                                    "children" : [ {
                                      "props" : {
                                        "children" : [ {
                                          "props" : {
                                            "label" : {
                                              "@class" : "Script",
                                              "content" : "\"1e vague\"",
                                              "language" : "JavaScript"
                                            },
                                            "layoutStyle" : { },
                                            "localScriptEval" : {
                                              "script" : {
                                                "@class" : "Script",
                                                "content" : "import {premiereVague} from './scenario';\n\npremiereVague();",
                                                "language" : "typescript"
                                              }
                                            },
                                            "style" : { }
                                          },
                                          "type" : "Button"
                                        } ],
                                        "layout" : { },
                                        "layoutStyle" : { },
                                        "name" : "Debug panel",
                                        "style" : { }
                                      },
                                      "type" : "FlexList"
                                    }, {
                                      "props" : {
                                        "OSMLayer" : false,
                                        "children" : [ {
                                          "props" : {
                                            "layerId" : "",
                                            "layerProps" : { },
                                            "layerSource" : {
                                              "dataType" : "GeoJSON",
                                              "source" : {
                                                "@class" : "Script",
                                                "content" : "return(`maps/${Context.mapId.mapId}/water.geojson`)",
                                                "language" : "typescript"
                                              },
                                              "sourceProjection" : "EPSG:4326",
                                              "type" : "VectorLayer",
                                              "useSpatialIndex" : true
                                            },
                                            "layerStyle" : {
                                              "@class" : "ScriptCallback",
                                              "args" : [ "feature", "resolution" ],
                                              "content" : "import { getWaterStyle } from \"./layerStyling\";\ngetWaterStyle(feature, resolution);"
                                            },
                                            "layoutStyle" : { },
                                            "name" : "water",
                                            "onLayerReady" : {
                                              "@class" : "ScriptCallback",
                                              "args" : [ "layer", "map" ],
                                              "content" : "import { ObstacleType, updateObstacleMatrixWithLayer } from \"./layersData\";\nupdateObstacleMatrixWithLayer(layer, map, Context.mapId.mapId, ObstacleType.Water, false, 'Recursive',8);\nreturn;"
                                            },
                                            "style" : { }
                                          },
                                          "type" : "WegasMapVectorLayer"
                                        }, {
                                          "props" : {
                                            "layerId" : "",
                                            "layerProps" : { },
                                            "layerSource" : {
                                              "dataType" : "GeoJSON",
                                              "source" : {
                                                "@class" : "Script",
                                                "content" : "return(`maps/${Context.mapId.mapId}/rails.geojson`)",
                                                "language" : "typescript"
                                              },
                                              "sourceProjection" : "EPSG:4326",
                                              "type" : "VectorLayer",
                                              "useSpatialIndex" : true
                                            },
                                            "layerStyle" : {
                                              "@class" : "ScriptCallback",
                                              "args" : [ "feature", "resolution" ],
                                              "content" : "import { getRailwayStyle } from \"./layerStyling\";\ngetRailwayStyle(resolution);"
                                            },
                                            "layoutStyle" : { },
                                            "name" : "rails",
                                            "onLayerReady" : {
                                              "@class" : "ScriptCallback",
                                              "args" : [ "layer", "map" ],
                                              "content" : "import { ObstacleType, updateObstacleMatrixWithLayer } from \"./layersData\";\nupdateObstacleMatrixWithLayer(layer, map, Context.mapId.mapId, ObstacleType.Train, false, 'Recursive', 64);\nreturn;"
                                            },
                                            "style" : { }
                                          },
                                          "type" : "WegasMapVectorLayer"
                                        }, {
                                          "props" : {
                                            "layerId" : "",
                                            "layerProps" : {
                                              "zIndex" : 10
                                            },
                                            "layerSource" : {
                                              "dataType" : "GeoJSON",
                                              "source" : {
                                                "@class" : "Script",
                                                "content" : "return(`maps/${Context.mapId.mapId}/roads.geojson`)",
                                                "language" : "typescript"
                                              },
                                              "sourceProjection" : "EPSG:4326",
                                              "type" : "VectorLayer",
                                              "useSpatialIndex" : true
                                            },
                                            "layerStyle" : {
                                              "@class" : "ScriptCallback",
                                              "args" : [ "feature", "resolution" ],
                                              "content" : "import { getRoadStyle } from \"./layerStyling\";\ngetRoadStyle(feature, resolution);"
                                            },
                                            "layoutStyle" : { },
                                            "name" : "roads",
                                            "onLayerReady" : {
                                              "@class" : "ScriptCallback",
                                              "args" : [ "layer", "map" ],
                                              "content" : "import { ObstacleType, updateObstacleMatrixWithLayer } from \"./layersData\";\nupdateObstacleMatrixWithLayer(layer, map, Context.mapId.mapId, ObstacleType.Road, true, 'Recursive', 64, true);\nreturn;"
                                            },
                                            "style" : { }
                                          },
                                          "type" : "WegasMapVectorLayer"
                                        }, {
                                          "props" : {
                                            "layerId" : "",
                                            "layerProps" : {
                                              "zIndex" : 15
                                            },
                                            "layerSource" : {
                                              "dataType" : "GeoJSON",
                                              "source" : {
                                                "@class" : "Script",
                                                "content" : "import { getHumanLayer } from \"./mapLayers\";\ngetHumanLayer();",
                                                "language" : "typescript"
                                              },
                                              "type" : "VectorLayer",
                                              "useSpatialIndex" : true
                                            },
                                            "layerStyle" : {
                                              "image" : {
                                                "fill" : {
                                                  "color" : "blue",
                                                  "type" : "FillStyle"
                                                },
                                                "radius" : 3,
                                                "stroke" : {
                                                  "color" : "black",
                                                  "lineCap" : "round",
                                                  "lineJoin" : "round",
                                                  "miterLimit" : 10,
                                                  "type" : "StrokeStyle",
                                                  "width" : 1
                                                },
                                                "type" : "CircleStyle"
                                              },
                                              "zIndex" : 5
                                            },
                                            "layoutStyle" : { },
                                            "name" : "humans",
                                            "onLayerReady" : {
                                              "@class" : "ScriptCallback",
                                              "args" : [ "layer" ],
                                              "content" : "return;"
                                            },
                                            "style" : { }
                                          },
                                          "type" : "WegasMapVectorLayer"
                                        }, {
                                          "props" : {
                                            "children" : [ {
                                              "props" : {
                                                "children" : [ {
                                                  "props" : {
                                                    "layoutStyle" : { },
                                                    "style" : { },
                                                    "text" : {
                                                      "@class" : "Script",
                                                      "content" : "import { getVisualOverviewForHumanId } from \"./graphics\";\ngetVisualOverviewForHumanId(Context.human.id, Context.resolution);",
                                                      "language" : "JavaScript"
                                                    }
                                                  },
                                                  "type" : "Text"
                                                }, {
                                                  "props" : {
                                                    "icon" : "stethoscope",
                                                    "impactVariable" : {
                                                      "impact" : {
                                                        "@class" : "Script",
                                                        "content" : "Variable.find(gameModel, 'currentPatient').setValue(self, Context.human.id);\nVariable.find(gameModel, 'showPatientModal').setValue(self, true);",
                                                        "language" : "JavaScript"
                                                      },
                                                      "priority" : 2
                                                    },
                                                    "label" : {
                                                      "@class" : "Script",
                                                      "content" : "\"&nbsp;\"",
                                                      "language" : "JavaScript"
                                                    },
                                                    "layoutClassName" : "stethoscope",
                                                    "layoutStyle" : { },
                                                    "localScriptEval" : {
                                                      "priority" : 1,
                                                      "script" : {
                                                        "@class" : "Script",
                                                        "content" : "import { goToHuman } from \"./the_world\";\n\ngoToHuman(Context.human.id);",
                                                        "language" : "typescript"
                                                      }
                                                    },
                                                    "stopPropagation" : true,
                                                    "style" : { }
                                                  },
                                                  "type" : "Button"
                                                } ],
                                                "className" : "humanOverlay",
                                                "conditionnalClassNames" : [ {
                                                  "applyOn" : "Inside",
                                                  "className" : "me",
                                                  "condition" : {
                                                    "@class" : "Script",
                                                    "content" : "import { whoAmI } from \"./WegasHelper\";\nContext.human.id === whoAmI();",
                                                    "language" : "JavaScript"
                                                  }
                                                }, {
                                                  "applyOn" : "Inside",
                                                  "className" : "not-me",
                                                  "condition" : {
                                                    "@class" : "Script",
                                                    "content" : "import { whoAmI } from \"./WegasHelper\";\nContext.human.id !== whoAmI();",
                                                    "language" : "JavaScript"
                                                  }
                                                } ],
                                                "layout" : { },
                                                "layoutStyle" : { },
                                                "style" : { }
                                              },
                                              "type" : "FlexList"
                                            } ],
                                            "exposedValueKeys" : {
                                              "exposePayloadAs" : "human",
                                              "exposeResolutionAs" : "resolution"
                                            },
                                            "getItemsFn" : {
                                              "@class" : "Script",
                                              "content" : "import { getHumanOverlays } from \"./mapLayers\";\ngetHumanOverlays();",
                                              "language" : "TypeScript"
                                            },
                                            "itemKey" : "id",
                                            "layoutStyle" : { },
                                            "name" : "Human Picto",
                                            "style" : { }
                                          },
                                          "type" : "WegasMapOverlays"
                                        }, {
                                          "props" : {
                                            "layerId" : "",
                                            "layerProps" : {
                                              "zIndex" : 100
                                            },
                                            "layerSource" : {
                                              "dataType" : "GeoJSON",
                                              "source" : {
                                                "@class" : "Script",
                                                "content" : "import { getBubbleLayer } from \"./mapLayers\";\ngetBubbleLayer();",
                                                "language" : "typescript"
                                              },
                                              "type" : "VectorLayer",
                                              "useSpatialIndex" : true
                                            },
                                            "layerStyle" : {
                                              "@class" : "ScriptCallback",
                                              "args" : [ "feature", "resolution" ],
                                              "content" : "({\n\t\"text\": {\n\t\t\"type\": \"TextStyle\",\n\t\t//\"fill\": { \"type\": \"FillStyle\" },\n\t\t//\"stroke\": { \"type\": \"StrokeStyle\", \"lineCap\": \"round\", \"lineJoin\": \"round\", \"miterLimit\": 1 },\n\t\t\"text\": feature.get(\"text\"), \n\t\t\"textAlign\": \"start\", \n\t\t\"placement\": \"point\", \n\t\t\"textBaseline\": \"bottom\"\n\t}\n})"
                                            },
                                            "layoutStyle" : { },
                                            "name" : "bubbles",
                                            "style" : { }
                                          },
                                          "type" : "WegasMapVectorLayer"
                                        }, {
                                          "props" : {
                                            "layerId" : "",
                                            "layerProps" : { },
                                            "layerSource" : {
                                              "dataType" : "GeoJSON",
                                              "source" : {
                                                "@class" : "Script",
                                                "content" : "//wlog(Context.mapId.mapId)\nreturn(`maps/${Context.mapId.mapId}/buildings.geojson`)",
                                                "language" : "typescript"
                                              },
                                              "sourceProjection" : "EPSG:4326",
                                              "type" : "VectorLayer",
                                              "useSpatialIndex" : true
                                            },
                                            "layerStyle" : {
                                              "fill" : {
                                                "color" : "grey",
                                                "type" : "FillStyle"
                                              }
                                            },
                                            "layoutStyle" : { },
                                            "name" : "buildings",
                                            "onLayerReady" : {
                                              "@class" : "ScriptCallback",
                                              "args" : [ "layer", "map" ],
                                              "content" : "import { buildingLayer, ObstacleType, updateObstacleMatrixWithLayer } from \"./layersData\";\nupdateObstacleMatrixWithLayer(layer, map, Context.mapId.mapId, ObstacleType.Building, false, 'Recursive', 32);\nbuildingLayer.current = layer;\nreturn;"
                                            },
                                            "style" : { }
                                          },
                                          "type" : "WegasMapVectorLayer"
                                        }, {
                                          "props" : {
                                            "layerId" : "",
                                            "layerProps" : { },
                                            "layerSource" : {
                                              "dataType" : "GeoJSON",
                                              "source" : {
                                                "@class" : "Script",
                                                "content" : "import { getFogOfWarLayer } from \"./mapLayers\";\ngetFogOfWarLayer(Context.mapId.mapId);",
                                                "language" : "typescript"
                                              },
                                              "sourceProjection" : "EPSG:2056",
                                              "type" : "VectorLayer",
                                              "useSpatialIndex" : false
                                            },
                                            "layerStyle" : {
                                              "fill" : {
                                                "color" : "#8f96a3aa",
                                                "type" : "FillStyle"
                                              },
                                              "zIndex" : 1
                                            },
                                            "layoutStyle" : { },
                                            "name" : "fogOfWar",
                                            "style" : { }
                                          },
                                          "type" : "WegasMapVectorLayer"
                                        }, {
                                          "props" : {
                                            "hideIf" : {
                                              "@class" : "Script",
                                              "content" : "true;",
                                              "language" : "JavaScript"
                                            },
                                            "layerId" : "",
                                            "layerProps" : {
                                              "zIndex" : 1000
                                            },
                                            "layerSource" : {
                                              "dataType" : "GeoJSON",
                                              "source" : {
                                                "@class" : "Script",
                                                "content" : "import { getDebugBuildingLayer } from \"./mapLayers\";\ngetDebugBuildingLayer()",
                                                "language" : "typescript"
                                              },
                                              "sourceProjection" : "EPSG:2056",
                                              "type" : "VectorLayer",
                                              "useSpatialIndex" : true
                                            },
                                            "layerStyle" : {
                                              "@class" : "ScriptCallback",
                                              "args" : [ "feature", "resolution" ],
                                              "content" : "const timeColor = (Context.worldTime.state.time ?? 0)*10 % 256;\n({\"fill\":{\"color\":\"rgb(\"+timeColor+\",100,0)\",\"type\":\"FillStyle\"}})"
                                            },
                                            "layoutStyle" : { },
                                            "name" : "[DEBUG] Visible buildings",
                                            "style" : { }
                                          },
                                          "type" : "WegasMapVectorLayer"
                                        }, {
                                          "props" : {
                                            "layerId" : "",
                                            "layerProps" : {
                                              "zIndex" : 10000
                                            },
                                            "layerSource" : {
                                              "dataType" : "GeoJSON",
                                              "source" : {
                                                "@class" : "Script",
                                                "content" : "import { getGridDebug } from \"./mapLayers\";\ngetGridDebug();",
                                                "language" : "typescript"
                                              },
                                              "sourceProjection" : "EPSG:2056",
                                              "type" : "VectorLayer",
                                              "useSpatialIndex" : true
                                            },
                                            "layerStyle" : {
                                              "@class" : "ScriptCallback",
                                              "args" : [ "feature", "resolution" ],
                                              "content" : "import { getCellStyle } from \"./mapLayers\";\ngetCellStyle(feature);"
                                            },
                                            "layoutStyle" : { },
                                            "name" : "[DEBUG] Obstacle grid",
                                            "style" : { }
                                          },
                                          "type" : "WegasMapVectorLayer"
                                        }, {
                                          "props" : {
                                            "layerId" : "",
                                            "layerProps" : { },
                                            "layerSource" : {
                                              "dataType" : "GeoJSON",
                                              "source" : {
                                                "@class" : "Script",
                                                "content" : "import { getPathLayer } from \"./mapLayers\";\ngetPathLayer();",
                                                "language" : "typescript"
                                              },
                                              "sourceProjection" : "EPSG:2056",
                                              "type" : "VectorLayer",
                                              "useSpatialIndex" : true
                                            },
                                            "layerStyle" : {
                                              "@class" : "ScriptCallback",
                                              "args" : [ "feature", "resolution" ],
                                              "content" : "({stroke:{\n\ttype:\"StrokeStyle\",\n\tcolor:feature.get(\"color\"),\n\twidth: 2\n}})"
                                            },
                                            "layoutStyle" : { },
                                            "name" : "[DEBUG] Character Paths",
                                            "style" : { }
                                          },
                                          "type" : "WegasMapVectorLayer"
                                        } ],
                                        "debug" : true,
                                        "id" : "",
                                        "layoutStyle" : {
                                          "backgroundColor" : "rgb(255,255,255)",
                                          "flexGrow" : "1",
                                          "height" : "500px",
                                          "width" : "100%"
                                        },
                                        "mapOptions" : {
                                          "onClick" : {
                                            "@class" : "ScriptCallback",
                                            "args" : [ "coord", "features" ],
                                            "content" : "import { handleClickOnMap } from \"./the_world\";\nhandleClickOnMap({x: coord[0], y: coord[1]}, features);\nreturn;"
                                          }
                                        },
                                        "style" : { },
                                        "viewOptions" : {
                                          "center" : [ 2539119, 1181103 ],
                                          "extent" : {
                                            "@class" : "Script",
                                            "content" : "//wlog(Context.mapExtentState.state);\nContext.mapExtentState.state.extent;",
                                            "language" : "typescript"
                                          },
                                          "projection" : {
                                            "@class" : "Script",
                                            "content" : "import { swissDefaultProjection } from \"./layersData\";\nswissDefaultProjection;",
                                            "language" : "typescript"
                                          }
                                        }
                                      },
                                      "type" : "WegasMap"
                                    } ],
                                    "layout" : {
                                      "flexDirection" : "column"
                                    },
                                    "layoutStyle" : {
                                      "overflow" : "auto",
                                      "width" : "100%"
                                    },
                                    "style" : { }
                                  },
                                  "type" : "FlexList"
                                } ]
                              },
                              "type" : "PlayerIf"
                            }, {
                              "props" : {
                                "children" : [ {
                                  "props" : {
                                    "children" : [ {
                                      "props" : {
                                        "layoutStyle" : { },
                                        "style" : { },
                                        "text" : {
                                          "@class" : "Script",
                                          "content" : "import { tryLoadExtentAsync } from \"./layersData\";\n\ntryLoadExtentAsync(Context.mapId.mapId, Context.mapExtentState.state, Context.mapExtentState.setState);\n`<p>Load state : ${Context.mapExtentState.state.loadState}<br></p>`",
                                          "language" : "JavaScript"
                                        }
                                      },
                                      "type" : "Text"
                                    } ]
                                  },
                                  "type" : "FlexList"
                                } ]
                              },
                              "type" : "PlayerElse"
                            } ],
                            "ifCondition" : {
                              "@class" : "Script",
                              "content" : "Context.mapExtentState.state.loadState == 'LOADED';",
                              "language" : "JavaScript"
                            },
                            "layoutStyle" : {
                              "width" : "100%"
                            },
                            "style" : { }
                          },
                          "type" : "If Else"
                        } ],
                        "exposeAs" : "mapExtentState",
                        "initialState" : {
                          "@class" : "Script",
                          "content" : "import { getInitialExtentState } from \"./layersData\";\ngetInitialExtentState();",
                          "language" : "TypeScript"
                        },
                        "layoutStyle" : {
                          "flexDirection" : "column",
                          "flexGrow" : "1",
                          "width" : "100%"
                        },
                        "localState" : true,
                        "name" : "Extent state",
                        "style" : { }
                      },
                      "type" : "State"
                    } ],
                    "layout" : {
                      "flexDirection" : "column"
                    },
                    "layoutStyle" : {
                      "overflow" : "auto",
                      "width" : "100%"
                    },
                    "style" : { }
                  },
                  "type" : "FlexList"
                } ]
              },
              "type" : "PlayerIf"
            }, {
              "props" : {
                "children" : [ {
                  "props" : {
                    "children" : [ {
                      "props" : {
                        "layoutStyle" : { },
                        "style" : { },
                        "text" : {
                          "@class" : "Script",
                          "content" : "\"<p>Your player is nowhere.</p><p>Where do you wanna pop ?<br></p>\"",
                          "language" : "JavaScript"
                        }
                      },
                      "type" : "Text"
                    }, {
                      "props" : {
                        "icon" : "location-arrow",
                        "label" : {
                          "@class" : "Script",
                          "content" : "\"<p>Go to Yverdon<br></p>\"",
                          "language" : "JavaScript"
                        },
                        "layoutStyle" : { },
                        "localScriptEval" : {
                          "script" : {
                            "@class" : "Script",
                            "content" : "import { setMapIdForPlayer } from \"./the_world\";\n\nsetMapIdForPlayer('yverdon');",
                            "language" : "typescript"
                          }
                        },
                        "name" : "Yverdon",
                        "style" : { }
                      },
                      "type" : "Button"
                    }, {
                      "props" : {
                        "icon" : "location-arrow",
                        "label" : {
                          "@class" : "Script",
                          "content" : "\"<p>Go to Geneva<br></p>\"",
                          "language" : "JavaScript"
                        },
                        "layoutStyle" : { },
                        "localScriptEval" : {
                          "script" : {
                            "@class" : "Script",
                            "content" : "import { setMapIdForPlayer } from \"./the_world\";\n\nsetMapIdForPlayer('geneva');",
                            "language" : "typescript"
                          }
                        },
                        "name" : "Geneva",
                        "style" : { }
                      },
                      "type" : "Button"
                    } ]
                  },
                  "type" : "FlexList"
                } ]
              },
              "type" : "PlayerElse"
            } ],
            "ifCondition" : {
              "@class" : "Script",
              "content" : "Context.mapId?.mapId?.length > 0;",
              "language" : "JavaScript"
            },
            "layoutStyle" : {
              "width" : "100%"
            },
            "style" : { }
          },
          "type" : "If Else"
        } ],
        "exposeAs" : "mapId",
        "getItemsFn" : {
          "@class" : "Script",
          "content" : "import { getCurrentMapId } from \"./helprs\";\n//wlog(getCurrentMapId());\n//return [{mapId : 'yverdon'}];\n[{mapId : getCurrentMapId()}];",
          "language" : "TypeScript"
        },
        "itemKey" : "mapId",
        "itemsOnly" : true,
        "layout" : { },
        "layoutStyle" : {
          "width" : "100%"
        },
        "style" : { }
      },
      "type" : "For each"
    } ],
    "className" : "",
    "layout" : {
      "flexDirection" : "column"
    },
    "layoutStyle" : {
      "height" : "100%",
      "overflow" : "auto",
      "width" : "100%"
    },
    "name" : "XX",
    "style" : { }
  },
  "type" : "FlexList"
}